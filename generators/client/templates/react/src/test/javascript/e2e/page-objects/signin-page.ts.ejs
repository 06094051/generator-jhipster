import { $, browser, ElementFinder<% if (authenticationType === 'oauth2') { _%>, element, by<% } %> } from 'protractor';

import BasePage from './base-component';
import { waitUntilDisplayed } from '../util/utils';

const selector: ElementFinder = $('#login-page');
export default class SignInPage extends BasePage {
  selector: ElementFinder;
  <%_ if (authenticationType !== 'oauth2') { _%>
  username: ElementFinder = this.selector.$('#username');
  password: ElementFinder = this.selector.$('#password');
  loginButton: ElementFinder = this.selector.$('button[type=submit]');
  <%_ } else { _%>
  username: ElementFinder = element(by.name('username'));
  password: ElementFinder = element(by.name('password'));
  loginButton: ElementFinder = element(by.css('input[type=submit]'));
  <%_ } _%>
  title: ElementFinder = this.selector.$('#login\\.title');

  constructor() {
    super(selector);
  }

  get() {
    browser.get('#/login');
    waitUntilDisplayed(this.title);
  }

  getTitle() {
    return this.title.getAttribute('id');
  }

  getUserName() {
    return this.username.getAttribute('value');
  }

  setUserName(username) {
    this.username.sendKeys(username);
  }

  clearUserName() {
    this.username.clear();
  }

  getPassword() {
    return this.password.getAttribute('value');
  }

  setPassword(password) {
    this.clearPassword();
    this.password.sendKeys(password);
  }

  clearPassword() {
    this.password.clear();
  }

  <%_ if (authenticationType !== 'oauth2') { _%>

  autoSignInUsing(username: string, password: string) {
    this.setUserName(username);
    this.setPassword(password);
    return this.login();
  }
  <%_ } else { _%>

  loginWithOAuth(username: string, password: string) {
    // Entering non angular site, tell webdriver to switch to synchronous mode.
    browser.waitForAngularEnabled(false);

    this.username.isPresent().then(() => {
        this.username.sendKeys(username);
        this.password.sendKeys(password);
        this.loginButton.click();
    });
  }
  <%_ } _%>

  autoSignOut() {
    browser.get('#/logout');
  }

  clearForm() {
    this.clearUserName();
    this.clearPassword();
  }

  login() {
    return this.loginButton.click();
  }
}
